# NestJS 11 Multi-Tenant SaaS Instructions

## 1. NestJS (TypeScript) & Prisma Rules
- **Strict Typing:** NEVER use `any`. Always define interfaces, types, or classes.
- **Validation:** Every Controller must use a DTO with `class-validator` decorators.
- **Architecture:** Strictly follow the Controller-Service-Repository pattern. Services handle business logic; Repositories handle database interactions via Prisma.
- **Error Handling:** Use built-in NestJS `HttpException` classes (e.g., `NotFoundException`, `BadRequestException`).
- **Multi-Tenancy:** Every database query must be scoped by `tenant_id`. Ensure the `PrismaService` extensions are utilized to prevent data leakage.
- **Dependency Injection:** Use constructor injection. Never instantiate services with the `new` keyword.

## 2. Infrastructure & Tooling
- **Database:** PostgreSQL 16 managed via Prisma 7.
- **Queues:** Use BullMQ for background jobs. Logic belongs in `.processor.ts` files.
- **Caching:** Utilize Redis 7 for session invalidation and job queuing.
- **Environment:** All configuration must be handled via `ConfigService` in the `src/config/` directory.

## 3. Agentic Behavior
- **Test-First:** Before completing a task, ask if you should generate a unit test (Jest).
- **Commit Style:** Use Conventional Commits (e.g., `feat:`, `fix:`, `refactor:`).
- **Self-Correction:** If a command fails in the terminal (e.g., during `npm run build`), analyze the stack trace and propose a fix immediately.
- **Documentation:** Maintain the `CONVENTIONS.md` file if any new architectural patterns are introduced.